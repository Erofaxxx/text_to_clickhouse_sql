# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ClickHouse Client

**Linux (Debian/Ubuntu):**
```bash
sudo apt-get install clickhouse-client
```

**macOS:**
```bash
brew install clickhouse
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
clickhouse-client --version
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.7+

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Python –≤–µ—Ä—Å–∏–∏ 3.7 –∏–ª–∏ –≤—ã—à–µ:

```bash
python3 --version
```

### 3. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/Erofaxxx/text_to_clickhouse_sql.git
cd text_to_clickhouse_sql
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

–ò–ª–∏ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º:

```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate     # Windows

pip install -r requirements.txt
```

### 5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª

```bash
cp .env.example .env
nano .env  # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:

**AI API –∫–ª—é—á (—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–¥–∏–Ω –∏–∑):**
- `OPENROUTER_API_KEY` - –∫–ª—é—á –æ—Ç OpenRouter (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - https://openrouter.ai/
- `ANTHROPIC_API_KEY` - –∫–ª—é—á –æ—Ç Anthropic - https://console.anthropic.com/
- `OPENAI_API_KEY` - –∫–ª—é—á –æ—Ç OpenAI - https://platform.openai.com/

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ClickHouse:**
- `CLICKHOUSE_HOST` - —Ö–æ—Å—Ç –≤–∞—à–µ–π –ë–î ClickHouse
- `CLICKHOUSE_USER` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `CLICKHOUSE_PASSWORD` - –ø–∞—Ä–æ–ª—å
- `CLICKHOUSE_DATABASE` - –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `CLICKHOUSE_TABLE` - –∏–º—è —Ç–∞–±–ª–∏—Ü—ã

### 6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É

```bash
python3 text_to_sql.py
```

### 7. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É

–ü—Ä–æ—Å—Ç–æ –ø–∏—à–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ:

```
üí¨ –í–∞—à –∑–∞–ø—Ä–æ—Å: –ü–æ–∫–∞–∂–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–µ–π
```

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é AI –≤ ClickHouse**, –∫–æ—Ç–æ—Ä–∞—è:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Å–ª–µ–¥—É–µ—Ç —Å—Ö–µ–º—É –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ—á–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫—É ClickHouse

## –ö–æ–º–∞–Ω–¥—ã –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ

- `help` - —Å–ø—Ä–∞–≤–∫–∞
- `schema` - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã
- `exit` - –≤—ã—Ö–æ–¥

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

1. "–ü–æ–∫–∞–∂–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –≤–∏–∑–∏—Ç–æ–≤"
2. "–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ"
3. "–ü–æ–∫–∞–∂–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π"
4. "–í—ã–≤–µ–¥–∏ —Ç–æ–ø 5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü"
5. "–ü–æ—Å—á–∏—Ç–∞–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤ –ø–æ –¥–Ω—è–º –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü"

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

**–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥:** –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é AI —Ñ—É–Ω–∫—Ü–∏—é ClickHouse –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∫ OpenRouter API.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
- üéØ –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
- üöÄ –ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ClickHouse
- üîÑ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–æ—Ä—Ç 8443)

### –í —á—ë–º –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞?

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ `CLICKHOUSE_PORT=8443` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç HTTPS –≤ Yandex Cloud) –ø–æ—è–≤–ª—è–ª–∞—Å—å –æ—à–∏–±–∫–∞:

```
‚úó –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ClickHouse
  Code: 102. DB::NetException: Unexpected packet from server
  (expected Hello or Exception, got )
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ?

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —É—Ç–∏–ª–∏—Ç—É `clickhouse-client`, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ **–Ω–∞—Ç–∏–≤–Ω—ã–π TCP-–ø—Ä–æ—Ç–æ–∫–æ–ª** ClickHouse. –ù–æ –ø–æ—Ä—Ç 8443 ‚Äî —ç—Ç–æ **HTTP/HTTPS –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ –¥—Ä—É–≥–æ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–µ. –≠—Ç–æ –∫–∞–∫ –ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–∑–≤–æ–Ω–∏—Ç—å –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É, –Ω–∞–±–∏—Ä–∞—è email-–∞–¥—Ä–µ—Å ‚Äî —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã —Å–≤—è–∑–∏.

**–ü–æ—Ä—Ç—ã ClickHouse –∏ –∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª—ã:**

| –ü–æ—Ä—Ç | –ü—Ä–æ—Ç–æ–∫–æ–ª | –î–ª—è —á–µ–≥–æ |
|------|----------|----------|
| 8443 | HTTPS (HTTP) | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, HTTP API |
| 8123 | HTTP | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è |
| 9440 | –ù–∞—Ç–∏–≤–Ω—ã–π TCP + TLS | `clickhouse-client` —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º |
| 9000 | –ù–∞—Ç–∏–≤–Ω—ã–π TCP | `clickhouse-client` –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è |

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ?

1. **–î–æ–±–∞–≤–ª–µ–Ω HTTP-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –ï—Å–ª–∏ –ø–æ—Ä—Ç 8443, 443 –∏–ª–∏ 8123 ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ HTTP/HTTPS –Ω–∞–ø—Ä—è–º—É—é –∏–∑ Python (–∏—Å–ø–æ–ª—å–∑—É—è `urllib`), –±–µ–∑ `clickhouse-client`. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è:
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (`SELECT 1`)
   - ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏—è —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü—ã (`DESCRIBE TABLE`)
   - ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

2. **AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç**: –î–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL (–∫–æ–º–∞–Ω–¥–∞ `??` –≤ `clickhouse-client`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç 9440 –≤–º–µ—Å—Ç–æ 8443.

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ HTTP-–∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` (Basic Auth), –∞ –Ω–µ –≤ URL.

4. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç**: –ï—Å–ª–∏ –Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç 9440, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å `CLICKHOUSE_NATIVE_PORT` –≤ `.env`:
   ```env
   CLICKHOUSE_NATIVE_PORT=9000  # –µ—Å–ª–∏ –Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç –±–µ–∑ TLS
   ```

### –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–µ–ø–µ—Ä—å?

```
‚úì AI Provider: openrouter
‚úì –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ ClickHouse –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö    ‚Üê –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **"clickhouse-client: command not found"**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ClickHouse Client (—Å–º. —à–∞–≥ 1)

2. **–û—à–∏–±–∫–∞ AI API**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω –≤ `.env`
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ

3. **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ClickHouse**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `.env`
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω

4. **–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π**
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `pip install -r requirements.txt`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç–∏–≤–∞—Ü–∏—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: —Å–º. [README.md](README.md)
